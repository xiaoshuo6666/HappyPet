<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Pet - 寵物關懷平台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8f4ff 0%, #f0e6ff 100%);
            color: #5a4a6a;
            line-height: 1.6;
            padding-top: 80px;
        }
        
  /* 导航栏样式 */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, #8a6db5 0%, #6b4e8e 100%);
            color: white;
            padding: 15px 0;
            box-shadow: 0 4px 12px rgba(107, 78, 142, 0.3);
            z-index: 1000;
        }
        
        .navbar-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Logo 样式 - 使用PNG图片 */
        .navbar-logo {
            display: flex;
            align-items: center;
            flex-shrink: 0;
            text-decoration: none;
            color: white;
        }

        .logo-image {
            height: 70px; /* 控制图片高度 */
            width: auto;  /* 宽度自动调整保持比例 */
            object-fit: contain;
        }

        .logo-text {
            font-size: 1.8rem;
            font-weight: bold;
            margin-left: 10px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .logo-image {
                height: 35px; /* 在移动端稍微调小 */
            }
            .logo-text {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .logo-text {
                display: none; /* 在超小屏幕隐藏文字，只显示图片 */
            }
        }

        .navbar-menu {
            display: flex;
            list-style: none;
        }
        
        .navbar-menu li {
            margin-left: 25px;
        }
        
        .navbar-menu a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        .navbar-menu a:hover {
            color: #e6d9ff;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .navbar-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* 统一的按钮样式系统 */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 20px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 500;
            text-align: center;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            white-space: nowrap;
            min-width: 100px;
            height: 40px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #8a6db5 0%, #6b4e8e 100%);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #7a5da5 0%, #5a3e7e 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn-outline {
            background-color: transparent;
            color: #8a6db5;
            border: 2px solid #8a6db5;
        }
        
        .btn-outline:hover {
            background-color: #8a6db5;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            min-width: 80px;
            height: 36px;
        }
        
        .btn-large {
            padding: 12px 24px;
            font-size: 18px;
            min-width: 120px;
            height: 48px;
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        /* 汉堡菜单 */
        .hamburger-menu {
            display: none;
            flex-direction: column;
            cursor: pointer;
            margin-left: 15px;
        }
        
        .hamburger-menu span {
            width: 25px;
            height: 3px;
            background-color: white;
            margin: 3px 0;
            transition: 0.3s;
            border-radius: 2px;
        }
        
        .mobile-menu {
            display: none;
            position: fixed;
            top: 80px;
            right: 0;
            width: 250px;
            background: linear-gradient(135deg, #8a6db5 0%, #6b4e8e 100%);
            box-shadow: -5px 5px 15px rgba(0, 0, 0, 0.2);
            border-radius: 0 0 0 10px;
            z-index: 999;
            padding: 20px;
        }
        
        .mobile-menu.active {
            display: block;
        }
        
        .mobile-menu ul {
            list-style: none;
        }
        
        .mobile-menu li {
            margin-bottom: 15px;
        }
        
        .mobile-menu a {
            color: white;
            text-decoration: none;
            font-size: 1.1rem;
            display: block;
            padding: 10px;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .mobile-menu a:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        section {
            padding: 60px 0;
            border-bottom: 1px solid #e6d9ff;
        }
        
        h1, h2 {
            color: #6b4e8e;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2.5rem;
            text-align: center;
        }
        
        h2 {
            font-size: 2rem;
            margin-top: 10px;
        }
        
        .header {
            background: linear-gradient(135deg, #8a6db5 0%, #6b4e8e 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
            box-shadow: 0 4px 12px rgba(107, 78, 142, 0.3);
            position: relative;
            overflow: hidden;
            margin-top: 20px;
            border-radius: 10px;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100" opacity="0.1"><path d="M30,30 Q50,10 70,30 T90,50 T70,70 T50,90 T30,70 T10,50 T30,30 Z" fill="white"/></svg>');
            background-size: 80px;
        }
        
        .header h1 {
            color: white;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        .warning {
            background-color: #ff6b8b;
            color: white;
            padding: 15px;
            margin: 20px 0;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(255, 107, 139, 0.3);
            font-weight: bold;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .slogan {
            text-align: center;
            font-size: 1.5rem;
            margin: 30px 0;
            color: #e6d9ff;
            font-weight: 300;
            letter-spacing: 1px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(107, 78, 142, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        th, td {
            padding: 18px;
            text-align: left;
            border-bottom: 1px solid #e6d9ff;
        }
        
        th {
            background: linear-gradient(135deg, #8a6db5 0%, #6b4e8e 100%);
            color: white;
            font-weight: 600;
        }
        
        tr:nth-child(even) {
            background-color: #f8f4ff;
        }
        
        tr:hover {
            background-color: #f0e6ff;
        }
        
        .photo-placeholder {
            width: 100px;
            height: 80px;
            background: linear-gradient(135deg, #d9c8f0 0%, #c5b0e6 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            color: #6b4e8e;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(107, 78, 142, 0.2);
        }
        
        .faq-section {
            background-color: #f8f4ff;
            border-radius: 10px;
        }
        
        .faq-item {
            margin-bottom: 20px;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(107, 78, 142, 0.1);
            border-left: 5px solid #8a6db5;
        }
        
        .faq-item strong {
            color: #8a6db5;
        }
        
        .footer {
            background: linear-gradient(135deg, #5a3f7a 0%, #4a3363 100%);
            color: white;
            text-align: center;
            padding: 40px 0;
            margin-top: 40px;
            border-radius: 10px 10px 0 0;
        }
        
        .how-to-section {
            background-color: #f8f4ff;
            border-radius: 10px;
        }
        
        .step {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(107, 78, 142, 0.1);
            transition: transform 0.3s;
        }
        
        .step:hover {
            transform: translateY(-5px);
        }
        
        .step-number {
            background: linear-gradient(135deg, #8a6db5 0%, #6b4e8e 100%);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            margin-right: 25px;
            flex-shrink: 0;
            box-shadow: 0 4px 8px rgba(138, 109, 181, 0.4);
        }
        
        .step-content {
            flex-grow: 1;
        }
        
        .step-content h3 {
            color: #6b4e8e;
            margin-bottom: 10px;
        }
        
        .pet-info-section {
            background-color: white;
            border-radius: 10px;
        }
        
        .pet-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .pet-card {
            background: linear-gradient(135deg, #f8f4ff 0%, #f0e6ff 100%);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(107, 78, 142, 0.1);
            transition: transform 0.3s;
            border-top: 4px solid #8a6db5;
        }
        
        .pet-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(107, 78, 142, 0.2);
        }
        
        .pet-card h3 {
            color: #6b4e8e;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .pet-card h3 i {
            margin-right: 10px;
            color: #8a6db5;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            display: block;
            width: 80px;
            height: 4px;
            background: linear-gradient(135deg, #8a6db5 0%, #6b4e8e 100%);
            margin: 15px auto;
            border-radius: 2px;
        }
        
        .pet-content-section {
            background: linear-gradient(135deg, #6b4e8e 0%, #5a3f7a 100%);
            color: white;
            padding: 50px 0;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(107, 78, 142, 0.3);
        }
        
        .pet-content-section h1 {
            color: white;
            margin-bottom: 30px;
            font-size: 2.8rem;
            letter-spacing: 2px;
        }
        
        .pet-content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .content-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s;
        }
        
        .content-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .content-card h3 {
            color: #e6d9ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .content-card h3 i {
            margin-right: 10px;
            color: #e6d9ff;
        }
        
        /* 模态窗口样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e6d9ff;
        }
        
        .modal-title {
            color: #6b4e8e;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b4e8e;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #6b4e8e;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #e6d9ff;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #8a6db5;
            box-shadow: 0 0 0 2px rgba(138, 109, 181, 0.2);
        }
        
        .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #e6d9ff;
            border-radius: 5px;
            font-size: 1rem;
            background-color: white;
            cursor: pointer;
        }
        
        .file-upload {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        
        .file-upload-btn {
            background: linear-gradient(135deg, #8a6db5 0%, #6b4e8e 100%);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            margin-right: 10px;
        }
        
        .file-name {
            color: #6b4e8e;
            font-size: 0.9rem;
        }
        
        .form-footer {
            margin-top: 25px;
            text-align: center;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #8a6db5 0%, #6b4e8e 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 500;
            font-size: 1rem;
            transition: all 0.3s;
            width: 100%;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(138, 109, 181, 0.4);
        }
        
        .switch-form {
            margin-top: 20px;
            text-align: center;
            color: #6b4e8e;
        }
        
        .switch-form a {
            color: #8a6db5;
            text-decoration: none;
            font-weight: 500;
        }
        
        .switch-form a:hover {
            text-decoration: underline;
        }
        
        /* 案件网格样式 */
        .cases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .case-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(107, 78, 142, 0.1);
            transition: transform 0.3s;
            cursor: pointer;
        }
        
        .case-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(107, 78, 142, 0.2);
        }
        
        .case-card-image {
            height: 200px;
            background: linear-gradient(135deg, #d9c8f0 0%, #c5b0e6 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .case-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .case-card-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff6b8b;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .case-card-content {
            padding: 20px;
        }
        
        .case-card-title {
            color: #6b4e8e;
            margin-bottom: 10px;
            font-size: 1.2rem;
            line-height: 1.4;
        }
        
        .case-card-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #888;
        }
        
        .case-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .case-card-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-open { background: #e3f2fd; color: #1976d2; }
        .status-in-progress { background: #fff3e0; color: #f57c00; }
        .status-completed { background: #e8f5e8; color: #388e3c; }
        .status-cancelled { background: #ffebee; color: #d32f2f; }
        
        .case-card-views {
            color: #888;
            font-size: 0.9rem;
        }
        
        .cases-scroll-container {
            max-height: 600px;
            overflow-y: auto;
            border: 2px solid #e6d9ff;
            border-radius: 15px;
            padding: 25px;
            background: linear-gradient(135deg, #faf8ff 0%, #f5f0ff 100%);
        }
        
        /* 案件照片预览样式 */
        .photo-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .photo-preview {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #e6d9ff;
        }
        
        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-photo {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .user-welcome {
            display: flex;
            align-items: center;
            color: white;
            font-weight: 500;
            margin-right: 10px;
        }
        
        .user-welcome i {
            margin-right: 5px;
        }
        
        .loading-text, .no-cases, .error-text {
            text-align: center;
            padding: 40px;
            color: #6b4e8e;
            font-size: 1.1rem;
        }
        
        @media (max-width: 768px) {
            .navbar-menu {
                display: none;
            }
            
            .hamburger-menu {
                display: flex;
            }
            
            .step {
                flex-direction: column;
                text-align: center;
            }
            
            .step-number {
                margin-right: 0;
                margin-bottom: 20px;
            }
            
            table {
                font-size: 0.9rem;
            }
            
            th, td {
                padding: 12px 8px;
            }
            
            .pet-info-grid, .pet-content-grid, .cases-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 20px;
                width: 95%;
            }
            
            .navbar-buttons {
                gap: 5px;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 0.9rem;
                min-width: 70px;
            }
        }
        
    </style>
</head>
<body>
    <!-- 固定顶部导航栏 -->
<nav class="navbar">
        <div class="navbar-container">
            <!-- Logo部分 -->
            <a href="#home" class="navbar-logo">
                <!-- 使用您的PNG图片 -->
                <img src="images/happy-pet-logo.png" 
                     alt="Happy Pet Logo" 
                     class="logo-image">
                <span class="logo-text">HAPPY PET</span>
            </a>

            <ul class="navbar-menu">
                <li><a href="#home">首頁</a></li>
                <li><a href="#cases">案件</a></li>
                <li><a href="#pet-content">資訊</a></li>
                <li><a href="#howto">使用</a></li>
                <li><a href="#faq">問題</a></li>
            </ul>
            <div class="navbar-buttons">
                <div class="user-welcome" id="userWelcome" style="display: none;">
                    <i class="fas fa-user"></i> <span id="welcomeText"></span>
                </div>
                <button class="btn btn-secondary btn-small" id="loginBtn">登入</button>
                <button class="btn btn-primary btn-small" id="registerBtn">註冊</button>
                <button class="btn btn-secondary btn-small" id="createCaseBtn" style="display: none;">
                    <i class="fas fa-plus"></i> 發布案件
                </button>
                <button class="btn btn-secondary btn-small" id="logoutBtn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> 登出
                </button>
                <button class="btn btn-secondary btn-small" id="myCasesBtn" style="display: none;">
                    <i class="fas fa-list"></i> 我的案件
                </button>
                <div class="hamburger-menu" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </nav>

    <!-- 我的案件模态窗口 -->
    <div class="modal" id="myCasesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">我的案件</h2>
                <button class="close-btn" id="closeMyCases">&times;</button>
            </div>
            <div class="cases-scroll-container">
                <div class="cases-grid" id="myCasesGrid">
                    <!-- 我的案件会动态加载 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 汉堡菜单 -->
    <div class="mobile-menu" id="mobileMenu">
        <ul>
            <li><a href="#home">首頁</a></li>
            <li><a href="#cases">案件一覽</a></li>
            <li><a href="#pet-content">寵物資訊</a></li>
            <li><a href="#howto">使用方法</a></li>
            <li><a href="#faq">常見問題</a></li>
        </ul>
    </div>

    <!-- 发布案件模态窗口 -->
    <div class="modal" id="createCaseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">發布新案件</h2>
                <button class="close-btn" id="closeCreateCase">&times;</button>
            </div>
            <form id="createCaseForm">
                <div class="form-group">
                    <label for="caseTitle">案件標題 *</label>
                    <input type="text" id="caseTitle" class="form-control" placeholder="請輸入案件標題" required>
                </div>
                
                <div class="form-group">
                    <label for="caseDescription">案件描述 *</label>
                    <textarea id="caseDescription" class="form-control" placeholder="請詳細描述案件內容..." rows="4" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="caseType">案件類型 *</label>
                    <select id="caseType" class="form-select" required>
                        <option value="">請選擇案件類型</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="caseLocation">地點 *</label>
                    <input type="text" id="caseLocation" class="form-control" placeholder="請輸入詳細地點" required>
                </div>

                <div class="form-group">
                    <label for="caseUrgency">緊急程度</label>
                    <select id="caseUrgency" class="form-select">
                        <option value="low">一般</option>
                        <option value="medium" selected>中等</option>
                        <option value="high">緊急</option>
                        <option value="emergency">非常緊急</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="caseBudget">預算 (NT$)</label>
                    <input type="number" id="caseBudget" class="form-control" placeholder="請輸入預算金額">
                </div>
                
                <div class="form-group">
                    <label for="caseStartDate">開始日期</label>
                    <input type="date" id="caseStartDate" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="caseEndDate">結束日期</label>
                    <input type="date" id="caseEndDate" class="form-control">
                </div>
                
                <div class="form-group">
                    <label>案件照片</label>
                    <div class="file-upload">
                        <button type="button" class="file-upload-btn" id="casePhotoUploadBtn">選擇照片</button>
                        <span class="file-name" id="casePhotoFileName">未選擇照片</span>
                    </div>
                    <div id="photoPreview" class="photo-preview-container"></div>
                </div>
                
                <div class="form-footer">
                    <button type="submit" class="submit-btn">發布案件</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 登录模态窗口 -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">登入</h2>
                <button class="close-btn" id="closeLogin">&times;</button>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginUsername">使用者名稱</label>
                    <input type="text" id="loginUsername" class="form-control" placeholder="請輸入使用者名稱" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">密碼</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="請輸入密碼" required>
                </div>
                <div class="form-footer">
                    <button type="submit" class="submit-btn">登入</button>
                    <div class="switch-form">
                        還沒有帳號？ <a href="#" id="switchToRegister">立即註冊</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- 注册模态窗口 -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">註冊帳號</h2>
                <button class="close-btn" id="closeRegister">&times;</button>
            </div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerUsername">使用者名稱 *</label>
                    <input type="text" id="registerUsername" class="form-control" placeholder="請輸入使用者名稱" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">電子信箱 *</label>
                    <input type="email" id="registerEmail" class="form-control" placeholder="請輸入電子信箱" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">密碼 *</label>
                    <input type="password" id="registerPassword" class="form-control" placeholder="請輸入密碼" required>
                </div>
                <div class="form-group">
                    <label for="registerFullName">姓名</label>
                    <input type="text" id="registerFullName" class="form-control" placeholder="請輸入您的姓名">
                </div>
                <div class="form-group">
                    <label for="registerPhone">電話</label>
                    <input type="tel" id="registerPhone" class="form-control" placeholder="請輸入電話號碼">
                </div>
                <div class="form-group">
                    <label for="userRole">身份 *</label>
                    <select id="userRole" class="form-select" required>
                        <option value="">請選擇身份</option>
                        <option value="owner">飼主</option>
                        <option value="caretaker">照顧者</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="location">居住地</label>
                    <select id="location" class="form-select">
                        <option value="taoyuan" selected>桃園市</option>
                    </select>
                </div>
                <div class="form-footer">
                    <button type="submit" class="submit-btn">註冊</button>
                    <div class="switch-form">
                        已經有帳號了？ <a href="#" id="switchToLogin">立即登入</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- 顶部区域 -->
    <section class="header" id="home">
        <div class="container">
            <h1>HAPPY PET</h1>
            <div class="warning">
                <i class="fas fa-exclamation-triangle"></i> 最新消息：大同公園最近出沒北極熊請飼主小心
            </div>
            <div class="slogan">
                Happy Pet<br>
                We Care You Pet
            </div>
        </div>
    </section>

    <!-- 案件区域 -->
    <section id="cases">
        <div class="container">
            <!-- 更多案件區塊 -->
            <div id="more-cases" style="margin-top: 50px;">
                <h3 class="section-title" style="font-size: 1.8rem;">案件一覽</h3>
                <div class="cases-scroll-container">
                    <div class="cases-grid" id="casesGrid">
                        <!-- 案件卡片會動態載入 -->
                    </div>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary btn-large" id="loadMoreCases">
                        <i class="fas fa-plus"></i> 載入更多案件
                    </button>
                    <div id="loadingIndicator" style="display: none; margin-top: 15px;">
                        <i class="fas fa-spinner fa-spin"></i> 載入中...
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 宠物资讯区域 -->
    <section class="pet-content-section" id="pet-content">
        <div class="container">
            <h1>HAPPY PET</h1>
            <h2 class="section-title" style="color: #e6d9ff;">寵物的內容 資訊</h2>
            <div class="pet-content-grid">
                <div class="content-card">
                    <h3><i class="fas fa-paw"></i> 寵物日常照護</h3>
                    <p>提供寵物日常照護的全面指南，包括飲食、運動、清潔和日常互動等內容，幫助您為寵物提供最好的生活品質。</p>
                </div>
                <div class="content-card">
                    <h3><i class="fas fa-stethoscope"></i> 健康與醫療</h3>
                    <p>了解寵物常見疾病預防、疫苗接種時程、定期健康檢查的重要性，以及如何識別寵物健康問題的早期徵兆。</p>
                </div>
                <div class="content-card">
                    <h3><i class="fas fa-home"></i> 環境與安全</h3>
                    <p>打造寵物友善家居環境，學習如何確保寵物在家中和戶外的安全，預防意外事故的發生。</p>
                </div>
            </div>
        </div>
    </section>

    <!-- 使用方法區域 -->
    <section class="how-to-section" id="howto">
        <div class="container">
            <h2 class="section-title">使用方法</h2>
            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h3>註冊帳號</h3>
                    <p>點擊右上角的"註冊帳號"按鈕，填寫基本資料完成註冊流程。</p>
                </div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h3>登入系統</h3>
                    <p>使用您的帳號和密碼登入系統，開始使用Happy Pet的各項服務。</p>
                </div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h3>瀏覽資訊</h3>
                    <p>查看最新的寵物相關資訊、案件一覽和常見問題解答。</p>
                </div>
            </div>
        </div>
    </section>

    <!-- 常見問題區域 -->
    <section class="faq-section" id="faq">
        <div class="container">
            <h2 class="section-title">常見問題</h2>
            <div class="faq-item">
                <p><strong>Q：如何使用</strong></p>
                <p>A：請參考上方"使用方法"部分，按照步驟操作即可。</p>
            </div>
            <div class="faq-item">
                <p><strong>Q：如何註冊</strong></p>
                <p>A：點擊網站右上角的"註冊帳號"按鈕，填寫必要資訊即可完成註冊。</p>
            </div>
            <div class="faq-item">
                <p><strong>Q：忘記密碼怎麼辦</strong></p>
                <p>A：在登入頁面點擊"忘記密碼"，按照指示重設您的密碼。</p>
            </div>
            <div class="faq-item">
                <p><strong>Q：如何發布寵物相關案件</strong></p>
                <p>A：登入後點擊"發布案件"按鈕，填寫相關資訊並上傳照片即可。</p>
            </div>
        </div>
    </section>

    <!-- 頁尾 -->
    <footer class="footer">
        <div class="container">
            <p>Happy Pet &copy; 2025 版權所有</p>
            <p>聯絡我們: mcu@happypet.com | 客服專線: 0800-123-456</p>
            <p>地址: 銘傳大學</p>
            <div style="margin-top: 20px;">
              <div style="margin-top: 20px;">
  <div style="margin-top: 20px;">
    <a href="https://www.facebook.com/share/19yDQVWYuK/?mibextid=wwXIfr" target="_blank" style="color: white; text-decoration: none;">
        <i class="fab fa-facebook" style="font-size: 1.5rem; margin: 0 10px;"></i>
    </a>
    <a href="https://www.instagram.com/happypet_care/" target="_blank" style="color: white; text-decoration: none;">
        <i class="fab fa-instagram" style="font-size: 1.5rem; margin: 0 10px;"></i>
    </a>
    <a href="https://line.me/R/ti/p/@133hddog" target="_blank" style="color: white; text-decoration: none;">
        <i class="fab fa-line" style="font-size: 1.5rem; margin: 0 10px;"></i>
    </a>
</div>
    </footer>

    <script>
        // 移动端菜单切换
        document.getElementById('hamburger').addEventListener('click', function() {
            document.getElementById('mobileMenu').classList.toggle('active');
        });

        // 模态窗口控制
        document.getElementById('loginBtn').addEventListener('click', function() {
            document.getElementById('loginModal').classList.add('active');
        });

        document.getElementById('registerBtn').addEventListener('click', function() {
            document.getElementById('registerModal').classList.add('active');
        });

        document.getElementById('createCaseBtn').addEventListener('click', function() {
            document.getElementById('createCaseModal').classList.add('active');
        });

        document.getElementById('myCasesBtn').addEventListener('click', function() {
            document.getElementById('myCasesModal').classList.add('active');
        });

        // 关闭模态窗口
        document.getElementById('closeLogin').addEventListener('click', function() {
            document.getElementById('loginModal').classList.remove('active');
        });

        document.getElementById('closeRegister').addEventListener('click', function() {
            document.getElementById('registerModal').classList.remove('active');
        });

        document.getElementById('closeCreateCase').addEventListener('click', function() {
            document.getElementById('createCaseModal').classList.remove('active');
        });

        document.getElementById('closeMyCases').addEventListener('click', function() {
            document.getElementById('myCasesModal').classList.remove('active');
        });

        // 切换表单
        document.getElementById('switchToRegister').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('loginModal').classList.remove('active');
            document.getElementById('registerModal').classList.add('active');
        });

        document.getElementById('switchToLogin').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('registerModal').classList.remove('active');
            document.getElementById('loginModal').classList.add('active');
        });

        // 点击模态窗口外部关闭
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });

        // 表单提交处理
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('登入成功！');
            document.getElementById('loginModal').classList.remove('active');
            // 模拟登录状态
            document.getElementById('userWelcome').style.display = 'flex';
            document.getElementById('welcomeText').textContent = '歡迎，使用者！';
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('registerBtn').style.display = 'none';
            document.getElementById('createCaseBtn').style.display = 'inline-flex';
            document.getElementById('logoutBtn').style.display = 'inline-flex';
            document.getElementById('myCasesBtn').style.display = 'inline-flex';
        });

        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('註冊成功！');
            document.getElementById('registerModal').classList.remove('active');
        });

        document.getElementById('createCaseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('案件發布成功！');
            document.getElementById('createCaseModal').classList.remove('active');
        });

        // 登出功能
        document.getElementById('logoutBtn').addEventListener('click', function() {
            document.getElementById('userWelcome').style.display = 'none';
            document.getElementById('loginBtn').style.display = 'inline-flex';
            document.getElementById('registerBtn').style.display = 'inline-flex';
            document.getElementById('createCaseBtn').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'none';
            document.getElementById('myCasesBtn').style.display = 'none';
            alert('已成功登出！');
        });

        // 载入更多案件
        document.getElementById('loadMoreCases').addEventListener('click', function() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const loadMoreBtn = document.getElementById('loadMoreCases');
            
            loadingIndicator.style.display = 'block';
            loadMoreBtn.disabled = true;
            
            // 模拟加载延迟
            setTimeout(function() {
                // 这里可以添加实际加载案件的代码
                loadingIndicator.style.display = 'none';
                loadMoreBtn.disabled = false;
                alert('已加载更多案件！');
            }, 1500);
        });
    </script>
</body>
</html>
<script>
    // API 基礎網址 - 連接到你的後端
    const API_BASE_URL = 'http://localhost:3000/api';

    // 全局變量
    let currentUser = null;
    let currentPage = 1;
    const casesPerPage = 6;
    let isLoading = false;
    let casePhotos = [];
    let casePhotoInput = null;

    // =============================
    // API 函數 - 後端連接
    // =============================

    async function registerUser(userData) {
        try {
            const response = await fetch(`${API_BASE_URL}/register`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(userData)
            });
            const result = await response.json();
            return result;
        } catch (error) {
            console.error('註冊錯誤:', error);
            return { error: '網路錯誤，請稍後再試' };
        }
    }

    async function loginUser(credentials) {
        try {
            const response = await fetch(`${API_BASE_URL}/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(credentials)
            });
            const result = await response.json();
            return result;
        } catch (error) {
            console.error('登入錯誤:', error);
            return { error: '網路錯誤，請稍後再試' };
        }
    }

    async function getCases() {
        try {
            const response = await fetch(`${API_BASE_URL}/cases`);
            const cases = await response.json();
            return cases;
        } catch (error) {
            console.error('獲取案件錯誤:', error);
            return [];
        }
    }

    async function getUserCases(userId) {
        try {
            const token = localStorage.getItem('token');
            const response = await fetch(`${API_BASE_URL}/user/cases`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            const cases = await response.json();
            return cases;
        } catch (error) {
            console.error('獲取用戶案件錯誤:', error);
            return [];
        }
    }

    async function getPetTypes() {
        try {
            const response = await fetch(`${API_BASE_URL}/pet-types`);
            return await response.json();
        } catch (error) {
            console.error('獲取寵物種類錯誤:', error);
            return [];
        }
    }

    async function getFAQs() {
        try {
            const response = await fetch(`${API_BASE_URL}/faqs`);
            return await response.json();
        } catch (error) {
            console.error('獲取FAQ錯誤:', error);
            return [];
        }
    }

    async function getCaseTypes() {
        try {
            const response = await fetch(`${API_BASE_URL}/case-types`);
            return await response.json();
        } catch (error) {
            console.error('獲取案件類型錯誤:', error);
            return [];
        }
    }

    // =============================
    // 核心功能函数
    // =============================

    async function loadCaseTypes() {
        try {
            console.log('正在加載案件類型...');
            const caseTypes = await getCaseTypes();
            const caseTypeSelect = document.getElementById('caseType');
            
            if (!caseTypeSelect) return;
            
            caseTypeSelect.innerHTML = '<option value="">請選擇案件類型</option>';
            
            if (caseTypes && caseTypes.length > 0) {
                caseTypes.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type.id;
                    option.textContent = type.type_name;
                    caseTypeSelect.appendChild(option);
                });
                console.log('案件類型加載成功:', caseTypes);
            } else {
                // 如果後端沒有返回數據，使用默認值
                const defaultTypes = [
                    { id: 1, type_name: '走失協尋' },
                    { id: 2, type_name: '醫療協助' },
                    { id: 3, type_name: '臨時寄養' },
                    { id: 4, type_name: '美容服務' },
                    { id: 5, type_name: '訓練協助' },
                    { id: 6, type_name: '其他服務' }
                ];
                
                defaultTypes.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type.id;
                    option.textContent = type.type_name;
                    caseTypeSelect.appendChild(option);
                });
                console.log('使用默認案件類型');
            }
            
        } catch (error) {
            console.error('載入案件類型錯誤:', error);
            // 使用默認案件類型
            const caseTypeSelect = document.getElementById('caseType');
            if (caseTypeSelect) {
                caseTypeSelect.innerHTML = `
                    <option value="">請選擇案件類型</option>
                    <option value="1">走失協尋</option>
                    <option value="2">醫療協助</option>
                    <option value="3">臨時寄養</option>
                    <option value="4">美容服務</option>
                    <option value="5">訓練協助</option>
                    <option value="6">其他服務</option>
                `;
            }
        }
    }

    // =============================
    // 初始化函数
    // =============================

    // DOM 加載完成後初始化
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🔄 頁面加載完成，開始初始化...');
        
        // 檢查登入狀態
        const token = localStorage.getItem('token');
        const user = localStorage.getItem('user');
        
        if (token && user) {
            try {
                currentUser = JSON.parse(user);
                updateLoginStatus(currentUser);
            } catch (error) {
                console.error('解析用戶數據錯誤:', error);
                localStorage.removeItem('token');
                localStorage.removeItem('user');
            }
        }
        
        // 初始化所有功能
        initNavigation();
        initModals();
        initCaseCreation();
        initCaseLoading();
        initLogoutButton();
        
        // 載入案件類型
        loadCaseTypes();
        
        // 載入動態資料
        loadDynamicData();
        
        // 測試後端連接
        testBackendConnection();
    });

    // 初始化導航功能
    function initNavigation() {
        const hamburger = document.getElementById('hamburger');
        const mobileMenu = document.getElementById('mobileMenu');
        
        // 漢堡選單功能
        hamburger.addEventListener('click', function() {
            mobileMenu.classList.toggle('active');
            this.classList.toggle('active');
        });
        
        // 點擊選單項後關閉選單
        document.querySelectorAll('.mobile-menu a').forEach(item => {
            item.addEventListener('click', () => {
                mobileMenu.classList.remove('active');
                hamburger.classList.remove('active');
            });
        });
        
        // 平滑滾動到錨點
        document.querySelectorAll('.navbar-menu a, .mobile-menu a').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            });
        });
        
        // 導航欄滾動效果
        window.addEventListener('scroll', function() {
            const navbar = document.querySelector('.navbar');
            if (window.scrollY > 50) {
                navbar.style.padding = '10px 0';
                navbar.style.boxShadow = '0 4px 12px rgba(107, 78, 142, 0.4)';
            } else {
                navbar.style.padding = '15px 0';
                navbar.style.boxShadow = '0 4px 12px rgba(107, 78, 142, 0.3)';
            }
        });
    }

    // 初始化模態窗口
    function initModals() {
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const loginModal = document.getElementById('loginModal');
        const registerModal = document.getElementById('registerModal');
        const closeLogin = document.getElementById('closeLogin');
        const closeRegister = document.getElementById('closeRegister');
        const switchToRegister = document.getElementById('switchToRegister');
        const switchToLogin = document.getElementById('switchToLogin');
        
        // 打開登入模態窗口
        loginBtn.addEventListener('click', function() {
            loginModal.classList.add('active');
        });
        
        // 打開註冊模態窗口
        registerBtn.addEventListener('click', function() {
            registerModal.classList.add('active');
        });
        
        // 關閉模態窗口
        closeLogin.addEventListener('click', function() {
            loginModal.classList.remove('active');
        });
        
        closeRegister.addEventListener('click', function() {
            registerModal.classList.remove('active');
        });
        
        // 切換表單
        switchToRegister.addEventListener('click', function(e) {
            e.preventDefault();
            loginModal.classList.remove('active');
            registerModal.classList.add('active');
        });
        
        switchToLogin.addEventListener('click', function(e) {
            e.preventDefault();
            registerModal.classList.remove('active');
            loginModal.classList.add('active');
        });
        
        // 點擊模態窗口外部關閉
        window.addEventListener('click', function(e) {
            if (e.target === loginModal) {
                loginModal.classList.remove('active');
            }
            if (e.target === registerModal) {
                registerModal.classList.remove('active');
            }
        });
        
        // 表單提交處理
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await handleLogin();
        });
        
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await handleRegister();
        });
    }

// 初始化案件創建功能
function initCaseCreation() {
    const createCaseBtn = document.getElementById('createCaseBtn');
    const myCasesBtn = document.getElementById('myCasesBtn');
    const createCaseModal = document.getElementById('createCaseModal');
    const myCasesModal = document.getElementById('myCasesModal');
    const closeCreateCase = document.getElementById('closeCreateCase');
    const closeMyCases = document.getElementById('closeMyCases');
    const createCaseForm = document.getElementById('createCaseForm');
    
    console.log('初始化案件創建功能...');
    console.log('myCasesBtn:', myCasesBtn);
    console.log('myCasesModal:', myCasesModal);
    
    // 打開發布案件模態窗口（飼主）
    if (createCaseBtn) {
        createCaseBtn.addEventListener('click', function() {
            console.log('點擊發布案件按鈕');
            if (!currentUser) {
                alert('請先登入才能發布案件');
                document.getElementById('loginModal').classList.add('active');
                return;
            }
            // 确保案件类型下拉菜单已加载
            loadCaseTypes();
            createCaseModal.classList.add('active');
        });
    }
    
    // 打開我的案件模態窗口（照顧者）
    if (myCasesBtn) {
        console.log('找到我的案件按鈕，添加事件監聽器');
        myCasesBtn.addEventListener('click', function() {
            console.log('點擊我的案件按鈕，當前用戶:', currentUser);
            if (!currentUser) {
                alert('請先登入');
                document.getElementById('loginModal').classList.add('active');
                return;
            }
            loadMyCases();
            myCasesModal.classList.add('active');
        });
    } else {
        console.error('❌ 找不到我的案件按鈕！');
    }
    
    // 關閉模態窗口
    if (closeCreateCase) {
        closeCreateCase.addEventListener('click', function() {
            createCaseModal.classList.remove('active');
            resetCaseForm();
        });
    }
    
    if (closeMyCases) {
        closeMyCases.addEventListener('click', function() {
            myCasesModal.classList.remove('active');
        });
    }
    
    // 點擊外部關閉
    if (createCaseModal) {
        createCaseModal.addEventListener('click', function(e) {
            if (e.target === createCaseModal) {
                createCaseModal.classList.remove('active');
                resetCaseForm();
            }
        });
    }
    
    if (myCasesModal) {
        myCasesModal.addEventListener('click', function(e) {
            if (e.target === myCasesModal) {
                myCasesModal.classList.remove('active');
            }
        });
    }
    
    // 案件照片上傳
    const casePhotoUploadBtn = document.getElementById('casePhotoUploadBtn');
    const casePhotoFileName = document.getElementById('casePhotoFileName');
    
    casePhotoInput = document.createElement('input');
    casePhotoInput.type = 'file';
    casePhotoInput.accept = 'image/*';
    casePhotoInput.multiple = true;
    casePhotoInput.style.display = 'none';
    document.body.appendChild(casePhotoInput);
    
    if (casePhotoUploadBtn) {
        casePhotoUploadBtn.addEventListener('click', function() {
            casePhotoInput.click();
        });
    }
    
    casePhotoInput.addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
            handleCasePhotoSelection(e.target.files);
        }
    });
    
    // 表單提交
    if (createCaseForm) {
        createCaseForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            await submitCase();
        });
    }
}

    // 初始化案件加載功能
    function initCaseLoading() {
        const loadMoreBtn = document.getElementById('loadMoreCases');
        if (loadMoreBtn) {
            loadMoreBtn.addEventListener('click', loadMoreCases);
            // 自動加載第一頁
            setTimeout(() => loadMoreCases(), 500);
        }
    }

    // =============================
    // 處理函數 - 後端連接
    // =============================

    async function handleLogin() {
        const username = document.getElementById('loginUsername').value;
        const password = document.getElementById('loginPassword').value;
        
        if (!username || !password) {
            alert('請填寫使用者名稱和密碼');
            return;
        }
        
        const result = await loginUser({ username, password });
        
        if (result.token) {
            alert('登入成功！');
            localStorage.setItem('token', result.token);
            localStorage.setItem('user', JSON.stringify(result.user));
            currentUser = result.user;
            document.getElementById('loginModal').classList.remove('active');
            updateLoginStatus(currentUser);
            resetLoginForm();
            
            // 登入成功後重新加載案件數據
            refreshCases();
        } else {
            alert('登入失敗: ' + (result.error || '請檢查使用者名稱和密碼'));
        }
    }

    async function handleRegister() {
        const userData = {
            username: document.getElementById('registerUsername').value,
            email: document.getElementById('registerEmail').value,
            password: document.getElementById('registerPassword').value,
            full_name: document.getElementById('registerFullName')?.value || '',
            phone: document.getElementById('registerPhone')?.value || '',
            location: document.getElementById('location').value,
            role: document.getElementById('userRole').value
        };
        
        if (!userData.username || !userData.email || !userData.password || !userData.role) {
            alert('請填寫所有必填欄位');
            return;
        }
        
        const result = await registerUser(userData);
        
        if (result.userId) {
            alert('註冊成功！請登入您的帳號。');
            document.getElementById('registerModal').classList.remove('active');
            document.getElementById('loginModal').classList.add('active');
            resetRegisterForm();
        } else {
            alert('註冊失敗: ' + (result.error || '請檢查輸入資料'));
        }
    }

    async function loadMoreCases() {
        if (isLoading) return;
        
        isLoading = true;
        const loadBtn = document.getElementById('loadMoreCases');
        const loadingIndicator = document.getElementById('loadingIndicator');
        
        if (loadBtn) loadBtn.disabled = true;
        if (loadingIndicator) loadingIndicator.style.display = 'block';
        
        try {
            console.log(`正在加載第 ${currentPage} 頁案件...`);
            
            // 先尝试使用分页 API
            let cases = [];
            try {
                const response = await fetch(`${API_BASE_URL}/cases/more?page=${currentPage}&limit=${casesPerPage}`);
                if (response.ok) {
                    cases = await response.json();
                    console.log('✅ 使用分頁 API 加載案件:', cases.length);
                } else {
                    throw new Error('分頁 API 不存在');
                }
            } catch (error) {
                console.log('分頁 API 不可用，使用普通案件 API');
                // 如果分頁 API 不存在，使用普通案件 API 並手動分頁
                const allCases = await getCases();
                const startIndex = (currentPage - 1) * casesPerPage;
                const endIndex = startIndex + casesPerPage;
                cases = allCases.slice(startIndex, endIndex);
                console.log('✅ 使用普通 API 加載案件:', cases.length);
            }
            
            const casesGrid = document.getElementById('casesGrid');
            
            if (cases.length === 0) {
                if (loadBtn) {
                    loadBtn.innerHTML = '<i class="fas fa-check"></i> 已載入所有案件';
                    loadBtn.style.background = 'linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)';
                    loadBtn.disabled = true;
                }
                if (loadingIndicator) loadingIndicator.style.display = 'none';
                return;
            }
            
            cases.forEach(caseItem => {
                const caseCard = createCaseCard(caseItem);
                if (casesGrid) casesGrid.appendChild(caseCard);
            });
            
            currentPage++;
            
            // 如果返回的案件數少於每頁數量，隱藏按鈕
            if (cases.length < casesPerPage) {
                if (loadBtn) {
                    loadBtn.innerHTML = '<i class="fas fa-check"></i> 已載入所有案件';
                    loadBtn.style.background = 'linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)';
                    loadBtn.disabled = true;
                }
            }
            
        } catch (error) {
            console.error('載入更多案件錯誤:', error);
            // 使用備用數據
            loadFallbackCases();
        } finally {
            isLoading = false;
            if (loadBtn) loadBtn.disabled = false;
            if (loadingIndicator) loadingIndicator.style.display = 'none';
        }
    }

    // 載入我的案件（照顧者）
    async function loadMyCases() {
        try {
            const myCasesGrid = document.getElementById('myCasesGrid');
            if (!myCasesGrid) return;
            
            myCasesGrid.innerHTML = '<div class="loading-text">載入中...</div>';
            
            const cases = await getUserCases(currentUser.id);
            
            if (cases.length === 0) {
                myCasesGrid.innerHTML = '<div class="no-cases">您還沒有發布任何案件</div>';
                return;
            }
            
            myCasesGrid.innerHTML = '';
            cases.forEach(caseItem => {
                const caseCard = createMyCaseCard(caseItem);
                myCasesGrid.appendChild(caseCard);
            });
            
        } catch (error) {
            console.error('載入我的案件錯誤:', error);
            const myCasesGrid = document.getElementById('myCasesGrid');
            if (myCasesGrid) {
                myCasesGrid.innerHTML = '<div class="error-text">載入失敗，請稍後再試</div>';
            }
        }
    }

 async function submitCase() {
    if (!currentUser) {
        alert('請先登入');
        return;
    }
    
    // 获取所有必填字段
    const title = document.getElementById('caseTitle').value;
    const description = document.getElementById('caseDescription').value;
    const case_type_id = document.getElementById('caseType').value;
    const location = document.getElementById('caseLocation').value;
    
    // 验证必填字段
    if (!title || !description || !case_type_id || !location) {
        alert('請填寫所有必填欄位（標題、描述、案件類型、地點）');
        return;
    }
    
    const formData = new FormData();
    
    // 添加案件數據 - 包含后端需要的所有字段
    formData.append('title', title);
    formData.append('description', description);
    formData.append('case_type_id', case_type_id);
    formData.append('location', location);
    formData.append('phone', '0900000000'); // 使用用户注册时的电话
    
    // 其他字段
    formData.append('urgency_level', document.getElementById('caseUrgency').value);
    
    const budget = document.getElementById('caseBudget').value;
    if (budget) formData.append('budget', budget);
    
    const startDate = document.getElementById('caseStartDate').value;
    if (startDate) formData.append('start_date', startDate);
    
    const endDate = document.getElementById('caseEndDate').value;
    if (endDate) formData.append('end_date', endDate);
    
    // 添加照片
    casePhotos.forEach((photo, index) => {
        formData.append('photos', photo);
    });
    
    try {
        const token = localStorage.getItem('token');
        
        console.log('正在提交案件...', {
            title, description, case_type_id, location,
            phone: currentUser.phone // 使用用户电话
        });
        
        const response = await fetch(`${API_BASE_URL}/cases`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            body: formData
        });
        
        const result = await response.json();
        
        if (response.ok) {
            alert('案件發布成功！');
            document.getElementById('createCaseModal').classList.remove('active');
            resetCaseForm();
            refreshCases();
        } else {
            const errorMsg = result.error || result.message || '未知錯誤';
            alert('案件發布失敗: ' + errorMsg);
            console.error('發布失敗詳細信息:', result);
        }
    } catch (error) {
        console.error('發布案件錯誤:', error);
        alert('發布失敗，請稍後再試: ' + error.message);
    }
}

    // =============================
    // 工具函數
    // =============================

function updateLoginStatus(user) {
    const loginBtn = document.getElementById('loginBtn');
    const registerBtn = document.getElementById('registerBtn');
    const createCaseBtn = document.getElementById('createCaseBtn');
    const myCasesBtn = document.getElementById('myCasesBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    
    console.log('🔄 更新登入狀態，用戶:', user);
    
    if (user) {
        // 用户已登录 - 显示欢迎信息和所有功能按钮
        const roleText = user.role === 'owner' ? '飼主' : (user.role === 'caretaker' ? '照顧者' : '用戶');
        loginBtn.textContent = `歡迎, ${user.username} (${roleText})`;
        loginBtn.style.display = 'block';
        loginBtn.style.background = 'transparent';
        loginBtn.style.border = '1px solid rgba(255,255,255,0.3)';
        loginBtn.style.cursor = 'default';
        loginBtn.disabled = true;
        
        registerBtn.style.display = 'none';
        
        // 飼主和照顧者都能看到所有功能
        console.log('✅ 顯示所有功能按鈕');
        if (createCaseBtn) {
            createCaseBtn.style.display = 'block';
            console.log('✅ 發布案件按鈕已顯示');
        }
        if (myCasesBtn) {
            myCasesBtn.style.display = 'block';
            console.log('✅ 我的案件按鈕已顯示');
        }
        
        if (logoutBtn) {
            logoutBtn.style.display = 'block';
            console.log('✅ 登出按鈕已顯示');
        }
    } else {
        // 用户未登录
        console.log('🚪 用戶未登入，重置所有按鈕');
        loginBtn.textContent = '登入';
        loginBtn.style.display = 'block';
        loginBtn.style.background = '';
        loginBtn.style.border = '';
        loginBtn.style.cursor = '';
        loginBtn.disabled = false;
        
        registerBtn.style.display = 'block';
        if (createCaseBtn) createCaseBtn.style.display = 'none';
        if (myCasesBtn) myCasesBtn.style.display = 'none';
        if (logoutBtn) logoutBtn.style.display = 'none';
    }
    
    // 打印最終按鈕狀態
    console.log('最終按鈕狀態:');
    console.log('- 發布案件:', createCaseBtn?.style.display);
    console.log('- 我的案件:', myCasesBtn?.style.display);
    console.log('- 登出:', logoutBtn?.style.display);
}
    // 登出功能
    function logout() {
        // 清除本地存储的登录信息
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        
        // 重置当前用户状态
        currentUser = null;
        
        // 更新界面显示
        updateLoginStatus(null);
        
        // 显示登出成功消息
        alert('已成功登出');
        
        // 刷新页面以更新数据
        location.reload();
    }

    // 初始化登出按钮事件
    function initLogoutButton() {
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('確定要登出嗎？')) {
                    logout();
                }
            });
        }
    }

    // 创建我的案件卡片（照顧者）
    function createMyCaseCard(caseItem) {
        const caseCard = document.createElement('div');
        caseCard.className = 'case-card';
        caseCard.onclick = () => viewCaseDetail(caseItem.id);
        
        const statusClass = getStatusClass(caseItem.status);
        const statusText = getStatusText(caseItem.status);
        
        const photoUrl = caseItem.main_photo ? 
            `${API_BASE_URL}/uploads/${caseItem.main_photo}` : 
            null;
        
        caseCard.innerHTML = `
            <div class="case-card-image">
                ${photoUrl ? 
                    `<img src="${photoUrl}" alt="${caseItem.title}" onerror="handleImageError(this)">` :
                    '<i class="fas fa-paw" style="font-size: 3rem; color: #6b4e8e;"></i>'
                }
                ${caseItem.urgency_level === 'emergency' ? '<div class="case-card-badge">緊急</div>' : ''}
            </div>
            <div class="case-card-content">
                <h3 class="case-card-title">${escapeHtml(caseItem.title)}</h3>
                <p class="case-card-description">${escapeHtml(caseItem.description.substring(0, 80))}${caseItem.description.length > 80 ? '...' : ''}</p>
                <div class="case-card-meta">
                    <span class="case-card-location">
                        <i class="fas fa-map-marker-alt"></i> ${escapeHtml(caseItem.location)}
                    </span>
                    <span class="case-card-date">
                        ${new Date(caseItem.created_at).toLocaleDateString()}
                    </span>
                </div>
                <div class="case-card-footer">
                    <span class="case-card-status ${statusClass}">${statusText}</span>
                    <span class="case-card-views">
                        <i class="fas fa-eye"></i> ${caseItem.view_count || 0}
                    </span>
                </div>
            </div>
        `;
        
        return caseCard;
    }

    // 图片错误处理
    function handleImageError(img) {
        console.log('❌ 圖片加載失敗:', img.src);
        img.style.display = 'none';
        
        // 显示默认图标
        const parent = img.parentNode;
        if (!parent.querySelector('.default-icon')) {
            parent.innerHTML = `
                <div class="default-icon" style="text-align: center; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; flex-direction: column; background: #f8f4ff;">
                    <i class="fas fa-camera" style="font-size: 3rem; color: #6b4e8e;"></i>
                    <p style="margin-top: 10px; color: #6b4e8e;">照片暫不可用</p>
                </div>
            `;
        }
    }

    // 在 createCaseCard 函数中修复照片路径
    function createCaseCard(caseItem) {
        const caseCard = document.createElement('div');
        caseCard.className = 'case-card';
        caseCard.onclick = () => viewCaseDetail(caseItem.id);
        
        const statusClass = getStatusClass(caseItem.status);
        const statusText = getStatusText(caseItem.status);
        
        // 修复照片路径 - 使用完整的HTTP URL
        const photoUrl = caseItem.main_photo ? 
            `${API_BASE_URL}/uploads/${caseItem.main_photo}` : 
            null;
        
        caseCard.innerHTML = `
            <div class="case-card-image">
                ${photoUrl ? 
                    `<img src="${photoUrl}" alt="${caseItem.title}" onerror="handleImageError(this)">` :
                    '<i class="fas fa-paw" style="font-size: 3rem; color: #6b4e8e;"></i>'
                }
                ${caseItem.urgency_level === 'emergency' ? '<div class="case-card-badge">緊急</div>' : ''}
            </div>
            <div class="case-card-content">
                <h3 class="case-card-title">${escapeHtml(caseItem.title)}</h3>
                <p class="case-card-description">${escapeHtml(caseItem.description.substring(0, 80))}${caseItem.description.length > 80 ? '...' : ''}</p>
                <div class="case-card-meta">
                    <span class="case-card-location">
                        <i class="fas fa-map-marker-alt"></i> ${escapeHtml(caseItem.location)}
                    </span>
                    <span class="case-card-date">
                        ${new Date(caseItem.created_at).toLocaleDateString()}
                    </span>
                </div>
                <div class="case-card-footer">
                    <span class="case-card-status ${statusClass}">${statusText}</span>
                    <span class="case-card-views">
                        <i class="fas fa-eye"></i> ${caseItem.view_count || 0}
                    </span>
                </div>
            </div>
        `;
        
        return caseCard;
    }

    // 案件照片處理
    function handleCasePhotoSelection(files) {
        const photoPreview = document.getElementById('photoPreview');
        
        Array.from(files).forEach((file, index) => {
            if (!file.type.startsWith('image/')) {
                alert('請選擇圖片文件！');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                alert('文件大小不能超過 5MB！');
                return;
            }
            
            casePhotos.push(file);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.createElement('div');
                preview.className = 'photo-preview';
                preview.innerHTML = `
                    <img src="${e.target.result}" alt="預覽">
                    <button type="button" class="remove-photo" onclick="removeCasePhoto(${casePhotos.length - 1})">&times;</button>
                `;
                photoPreview.appendChild(preview);
            };
            reader.readAsDataURL(file);
        });
        
        updateCaseFileDisplay();
    }

    // 移除案件照片
    function removeCasePhoto(index) {
        casePhotos.splice(index, 1);
        updateCaseFileDisplay();
        updateCasePhotoPreview();
    }

    // 更新文件顯示
    function updateCaseFileDisplay() {
        const fileNameCase = document.getElementById('casePhotoFileName');
        fileNameCase.textContent = casePhotos.length > 0 ? 
            `已選擇 ${casePhotos.length} 張照片` : '未選擇照片';
    }

    // 更新照片預覽
    function updateCasePhotoPreview() {
        const photoPreview = document.getElementById('photoPreview');
        photoPreview.innerHTML = '';
        
        casePhotos.forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.createElement('div');
                preview.className = 'photo-preview';
                preview.innerHTML = `
                    <img src="${e.target.result}" alt="預覽">
                    <button type="button" class="remove-photo" onclick="removeCasePhoto(${index})">&times;</button>
                `;
                photoPreview.appendChild(preview);
            };
            reader.readAsDataURL(file);
        });
    }

    // 備用案件數據
    function loadFallbackCases() {
        const fallbackCases = [
            {
                id: 4,
                title: '急需寵物美容服務',
                description: '家中的貴賓狗需要專業美容服務，毛髮過長影響活動',
                location: '台北市信義區',
                status: 'open',
                urgency_level: 'medium',
                view_count: 15,
                created_at: '2025-09-22'
            },
            {
                id: 5,
                title: '尋找寵物訓練師',
                description: '黃金獵犬需要基礎服從訓練，改善亂叫問題',
                location: '新北市中和區',
                status: 'open',
                urgency_level: 'low',
                view_count: 8,
                created_at: '2025-09-21'
            }
        ];
        
        const casesGrid = document.getElementById('casesGrid');
        fallbackCases.forEach(caseItem => {
            const caseCard = createCaseCard(caseItem);
            if (casesGrid) casesGrid.appendChild(caseCard);
        });
    }

    // 查看案件詳情
    function viewCaseDetail(caseId) {
        window.location.href = `case-detail.html?id=${caseId}`;
    }

    // 重置表單函數
    function resetCaseForm() {
        document.getElementById('createCaseForm').reset();
        casePhotos = [];
        document.getElementById('photoPreview').innerHTML = '';
        updateCaseFileDisplay();
    }

    function resetLoginForm() {
        document.getElementById('loginForm').reset();
    }

    function resetRegisterForm() {
        document.getElementById('registerForm').reset();
    }

    // 刷新案件列表
    function refreshCases() {
        const casesGrid = document.getElementById('casesGrid');
        if (casesGrid) {
            casesGrid.innerHTML = '';
            currentPage = 1;
            loadMoreCases();
        }
    }

    // =============================
    // 後端連接輔助函數
    // =============================

    async function testBackendConnection() {
        try {
            console.log('測試後端連接...');
            const response = await fetch(`${API_BASE_URL}/test-db`);
            if (response.ok) {
                const result = await response.json();
                console.log('✅ 後端連接成功:', result);
            } else {
                console.warn('⚠️ 後端連接測試失敗，狀態:', response.status);
            }
        } catch (error) {
            console.error('❌ 後端連接錯誤:', error);
            console.log('請確保後端服務器正在運行在 http://localhost:3000');
        }
    }

    async function loadDynamicData() {
        try {
            console.log('正在加載動態數據...');
            
            const [cases, petTypes, faqs, caseTypes] = await Promise.all([
                getCases(),
                getPetTypes(),
                getFAQs(),
                getCaseTypes()
            ]);
            
            console.log('動態數據加載完成:', { 
                cases: cases.length, 
                petTypes: petTypes.length, 
                faqs: faqs.length,
                caseTypes: caseTypes.length
            });
            
            // 更新頁面內容
            updatePageContent(cases, faqs);
            
        } catch (error) {
            console.error('載入動態資料錯誤:', error);
        }
    }

    function updatePageContent(cases, faqs) {
        console.log('更新頁面內容...');
        
        // 更新 FAQ 部分
        if (faqs && faqs.length > 0) {
            updateFAQs(faqs);
        }
    }

    function updateFAQs(faqs) {
        const faqContainer = document.querySelector('.faq-section .container');
        if (!faqContainer) return;
        
        // 清空現有 FAQ
        const existingFaqs = faqContainer.querySelectorAll('.faq-item');
        existingFaqs.forEach(faq => faq.remove());
        
        // 添加新的 FAQ
        faqs.forEach(faq => {
            const faqItem = document.createElement('div');
            faqItem.className = 'faq-item';
            faqItem.innerHTML = `
                <p><strong>Q：${faq.question}</strong></p>
                <p>A：${faq.answer}</p>
            `;
            faqContainer.appendChild(faqItem);
        });
    }

    // =============================
    // 通用工具函數
    // =============================

    function getStatusClass(status) {
        const classes = {
            'open': 'status-open',
            'in_progress': 'status-in-progress',
            'completed': 'status-completed',
            'cancelled': 'status-cancelled'
        };
        return classes[status] || 'status-open';
    }

    function getStatusText(status) {
        const texts = {
            'open': '開啟',
            'in_progress': '處理中',
            'completed': '已完成',
            'cancelled': '已取消'
        };
        return texts[status] || '開啟';
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
</script>