<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Pet - å¾Œå°ç®¡ç†ç³»çµ±</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #8a6db5;
            --primary-dark: #6b4e8e;
            --primary-light: #b8a2d4;
            --secondary: #ff9a76;
            --secondary-dark: #e87a56;
            --light: #f8f4ff;
            --lighter: #fefbff;
            --dark: #5a4a6a;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --info: #2196f3;
            --gray: #e0e0e0;
            --gray-dark: #9e9e9e;
            --shadow: 0 4px 12px rgba(107, 78, 142, 0.15);
            --shadow-lg: 0 10px 25px rgba(107, 78, 142, 0.2);
            --radius: 12px;
            --transition: all 0.3s ease;
            --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            --gradient-secondary: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft JhengHei', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8f4ff 0%, #f0e6ff 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding-top: 80px;
        }
        
        /* å¯¼èˆªæ æ ·å¼ */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: var(--gradient-primary);
            color: white;
            padding: 15px 0;
            box-shadow: var(--shadow);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .navbar-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .navbar-logo {
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            letter-spacing: 0.5px;
        }
        
        .navbar-logo i {
            margin-right: 12px;
            font-size: 1.8rem;
            color: var(--secondary);
        }
        
        .navbar-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .navbar-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        /* ä¸»å®¹å™¨æ ·å¼ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ç®¡ç†å‘˜å¤´éƒ¨æ ·å¼ */
        .admin-header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }
        
        .admin-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .admin-header p {
            font-size: 1.1rem;
            color: var(--gray-dark);
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡æ ·å¼ */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: var(--shadow);
            border-top: 4px solid var(--primary);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.5s ease;
        }
        
        .stat-card:hover::before {
            transform: scaleX(1);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .stat-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-number {
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin: 10px 0;
        }
        
        /* æ ‡ç­¾é¡µæ ·å¼ */
        .admin-tabs {
            display: flex;
            background: white;
            border-radius: var(--radius);
            padding: 10px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            gap: 5px;
        }
        
        .admin-tab-btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: var(--dark);
        }
        
        .admin-tab-btn.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 10px rgba(107, 78, 142, 0.3);
        }
        
        .admin-tab-btn:not(.active):hover {
            background: rgba(138, 109, 181, 0.1);
        }
        
        /* æ ‡ç­¾å†…å®¹æ ·å¼ */
        .admin-tab-content {
            display: none;
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .admin-tab-content.active {
            display: block;
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 0 0 1px var(--gray);
        }
        
        .data-table th, .data-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--gray);
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .data-table tr:hover {
            background-color: rgba(248, 244, 255, 0.5);
        }
        
        /* æ“ä½œæŒ‰é’®æ ·å¼ */
        .action-btn {
            padding: 8px 14px;
            margin: 2px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .edit-btn {
            background: rgba(33, 150, 243, 0.1);
            color: var(--info);
            border: 1px solid rgba(33, 150, 243, 0.3);
        }
        
        .delete-btn {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger);
            border: 1px solid rgba(244, 67, 54, 0.3);
        }
        
        .save-btn {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .cancel-btn {
            background: rgba(255, 152, 0, 0.1);
            color: var(--warning);
            border: 1px solid rgba(255, 152, 0, 0.3);
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .edit-btn:hover {
            background: var(--info);
            color: white;
        }
        
        .delete-btn:hover {
            background: var(--danger);
            color: white;
        }
        
        .save-btn:hover {
            background: var(--success);
            color: white;
        }
        
        .cancel-btn:hover {
            background: var(--warning);
            color: white;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: var(--radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .modal-content h3 {
            margin-bottom: 20px;
            color: var(--primary-dark);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .form-control {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--gray);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(138, 109, 181, 0.2);
        }
        
        /* çŠ¶æ€å¾½ç« æ ·å¼ */
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-block;
        }
        
        .status-open { background: rgba(33, 150, 243, 0.1); color: var(--info); }
        .status-in_progress { background: rgba(255, 152, 0, 0.1); color: var(--warning); }
        .status-completed { background: rgba(76, 175, 80, 0.1); color: var(--success); }
        .status-cancelled { background: rgba(244, 67, 54, 0.1); color: var(--danger); }
        
        /* ç”¨æˆ·ç±»å‹å¾½ç« æ ·å¼ */
        .user-type-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-block;
        }
        
        .user-type-admin { background: rgba(244, 67, 54, 0.1); color: var(--danger); }
        .user-type-owner { background: rgba(33, 150, 243, 0.1); color: var(--info); }
        .user-type-caretaker { background: rgba(76, 175, 80, 0.1); color: var(--success); }
        
        /* æœç´¢æ¡†æ ·å¼ */
        .search-box {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
        }
        
        .search-input {
            flex: 1;
            padding: 14px 20px;
            border: 1px solid var(--gray);
            border-radius: 30px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(138, 109, 181, 0.2);
        }
        
        .refresh-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(107, 78, 142, 0.3);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .admin-tabs {
                flex-direction: column;
            }
            
            .admin-stats {
                grid-template-columns: 1fr;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            .data-table {
                display: block;
                overflow-x: auto;
            }
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ç©ºçŠ¶æ€æ ·å¼ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-dark);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--gray);
        }
        
        /* å·¥å…·æç¤º */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 120px;
            background-color: var(--dark);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* å¡ç‰‡å¼å¸ƒå±€ */
        .card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            transition: var(--transition);
        }
        
        .card:hover {
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray);
        }
        
        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .badge {
            background: var(--gradient-primary);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        /* åˆ†é¡µæ§ä»¶ */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 5px;
        }
        
        .pagination-btn {
            padding: 8px 12px;
            border: 1px solid var(--gray);
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .pagination-btn.active {
            background: var(--gradient-primary);
            color: white;
            border-color: var(--primary);
        }
        
        .pagination-btn:hover:not(.active) {
            background: rgba(138, 109, 181, 0.1);
        }
        
        /* é€šçŸ¥æç¤º */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 15px 20px;
            border-radius: var(--radius);
            color: white;
            font-weight: 500;
            z-index: 3000;
            box-shadow: var(--shadow-lg);
            animation: slideInRight 0.3s ease;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .notification.success {
            background: var(--success);
        }
        
        .notification.error {
            background: var(--danger);
        }
        
        .notification.info {
            background: var(--info);
        }
        
        .notification.warning {
            background: var(--warning);
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 4000;
            display: none;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <!-- åŠ è½½é®ç½© -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-logo">
                <i class="fas fa-paw"></i> HAPPY PET - å¾Œå°ç®¡ç†
            </div>
            <div class="navbar-buttons">
                <button class="navbar-btn" onclick="location.href='index.html'">
                    <i class="fas fa-home"></i> è¿”å›å‰å°
                </button>
            </div>
        </div>
    </nav>

    <!-- ç®¡ç†å‘˜ç•Œé¢ -->
    <div class="container">
        <div class="admin-header">
            <h1>å¾Œå°ç®¡ç†ç³»çµ±</h1>
            <p>ç®¡ç†ç”¨æˆ¶ã€æ¡ˆä»¶å’Œç³»çµ±è³‡æ–™ï¼Œç¢ºä¿å¹³å°é‹ä½œé †æš¢</p>
        </div>

        <!-- ç»Ÿè®¡æ•°æ® -->
        <div class="admin-stats" id="adminStats">
            <!-- åŠ¨æ€åŠ è½½ -->
        </div>

        <!-- æ ‡ç­¾é¡µ -->
        <div class="admin-tabs">
            <button class="admin-tab-btn active" onclick="showAdminTab('users')">
                <i class="fas fa-users"></i> ç”¨æˆ¶ç®¡ç†
            </button>
            <button class="admin-tab-btn" onclick="showAdminTab('cases')">
                <i class="fas fa-clipboard-list"></i> æ¡ˆä»¶ç®¡ç†
            </button>
            <button class="admin-tab-btn" onclick="showAdminTab('faqs')">
                <i class="fas fa-question-circle"></i> FAQç®¡ç†
            </button>
        </div>

        <!-- æœç´¢æ¡† -->
        <div class="search-box">
            <input type="text" id="searchInput" class="search-input" placeholder="æœå°‹..." onkeyup="searchTable()">
            <button class="refresh-btn" onclick="refreshData()">
                <i class="fas fa-sync-alt"></i> åˆ·æ–°è³‡æ–™
            </button>
        </div>

        <!-- ç”¨æˆ·ç®¡ç† -->
        <div id="usersTab" class="admin-tab-content active">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ç”¨æˆ¶åˆ—è¡¨</h2>
                    <span id="usersCount" class="badge">å…± 0 ä½ç”¨æˆ¶</span>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>ç”¨æˆ¶å</th>
                            <th>Email</th>
                            <th>é¡å‹</th>
                            <th>å§“å</th>
                            <th>é›»è©±</th>
                            <th>åœ°å€</th>
                            <th>è¨»å†Šæ™‚é–“</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- åŠ¨æ€åŠ è½½ -->
                    </tbody>
                </table>
                <div class="pagination" id="usersPagination">
                    <!-- åˆ†é¡µæ§ä»¶ -->
                </div>
            </div>
        </div>

        <!-- æ¡ˆä»¶ç®¡ç† -->
        <div id="casesTab" class="admin-tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">æ¡ˆä»¶åˆ—è¡¨</h2>
                    <span id="casesCount" class="badge">å…± 0 å€‹æ¡ˆä»¶</span>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>æ¡ˆä»¶æ¨™é¡Œ</th>
                            <th>é¡å‹</th>
                            <th>ç‹€æ…‹</th>
                            <th>åœ°é»</th>
                            <th>å‰µå»ºè€…</th>
                            <th>å‰µå»ºæ™‚é–“</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="casesTableBody">
                        <!-- åŠ¨æ€åŠ è½½ -->
                    </tbody>
                </table>
                <div class="pagination" id="casesPagination">
                    <!-- åˆ†é¡µæ§ä»¶ -->
                </div>
            </div>
        </div>

        <!-- FAQç®¡ç† -->
        <div id="faqsTab" class="admin-tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">å¸¸è¦‹å•é¡Œç®¡ç†</h2>
                    <button class="action-btn edit-btn" onclick="showAddFAQModal()">
                        <i class="fas fa-plus"></i> æ–°å¢FAQ
                    </button>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>å•é¡Œ</th>
                            <th>ç­”æ¡ˆ</th>
                            <th>åˆ†é¡</th>
                            <th>æ’åº</th>
                            <th>ç‹€æ…‹</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="faqsTableBody">
                        <!-- åŠ¨æ€åŠ è½½ -->
                    </tbody>
                </table>
                <div class="pagination" id="faqsPagination">
                    <!-- åˆ†é¡µæ§ä»¶ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç¼–è¾‘ç”¨æˆ·æ¨¡æ€æ¡† -->
    <div class="modal" id="editUserModal">
        <div class="modal-content">
            <h3><i class="fas fa-user-edit"></i> ç·¨è¼¯ç”¨æˆ¶</h3>
            <form id="editUserForm">
                <input type="hidden" id="editUserId">
                <div class="form-group">
                    <label>ç”¨æˆ¶å</label>
                    <input type="text" id="editUsername" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="editEmail" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>ç”¨æˆ¶é¡å‹</label>
                    <select id="editUserType" class="form-control" required>
                        <option value="owner">é£¼ä¸»</option>
                        <option value="caretaker">ç…§é¡§è€…</option>
                        <option value="admin">ç®¡ç†å“¡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å§“å</label>
                    <input type="text" id="editFullName" class="form-control">
                </div>
                <div class="form-group">
                    <label>é›»è©±</label>
                    <input type="tel" id="editPhone" class="form-control">
                </div>
                <div class="form-group">
                    <label>åœ°å€</label>
                    <input type="text" id="editLocation" class="form-control">
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="action-btn save-btn" style="flex: 1;">
                        <i class="fas fa-save"></i> ä¿å­˜
                    </button>
                    <button type="button" class="action-btn cancel-btn" style="flex: 1;" onclick="closeEditUserModal()">
                        <i class="fas fa-times"></i> å–æ¶ˆ
                    </button>
                </div>
            </form>
        </div>
    </div>

  <!-- ç¼–è¾‘æ¡ˆä»¶æ¨¡æ€æ¡† - ä¿®æ”¹ç‰ˆæœ¬ -->
<div class="modal" id="editCaseModal">
    <div class="modal-content">
        <h3><i class="fas fa-clipboard-edit"></i> ç·¨è¼¯æ¡ˆä»¶</h3>
        <form id="editCaseForm">
            <input type="hidden" id="editCaseId">
            <div class="form-group">
                <label>æ¡ˆä»¶æ¨™é¡Œ *</label>
                <input type="text" id="editCaseTitle" class="form-control" required>
            </div>
            <div class="form-group">
                <label>æè¿° *</label>
                <textarea id="editCaseDescription" class="form-control" rows="3" required></textarea>
            </div>
            <div class="form-group">
                <label>æ¡ˆä»¶é¡å‹ *</label>
                <select id="editCaseType" class="form-control" required>
                    <!-- åŠ¨æ€åŠ è½½ -->
                </select>
            </div>
            <div class="form-group">
                <label>åœ°é» *</label>
                <input type="text" id="editCaseLocation" class="form-control" required>
            </div>
            <div class="form-group">
                <label>ç‹€æ…‹ *</label>
                <select id="editCaseStatus" class="form-control" required>
                    <option value="open">é–‹æ”¾</option>
                    <option value="in_progress">é€²è¡Œä¸­</option>
                    <option value="completed">å·²å®Œæˆ</option>
                    <option value="cancelled">å·²å–æ¶ˆ</option>
                </select>
            </div>
            <div class="form-group">
                <label>ç·Šæ€¥ç¨‹åº¦</label>
                <select id="editCaseUrgency" class="form-control">
                    <option value="low">ä½</option>
                    <option value="medium">ä¸­</option>
                    <option value="high">é«˜</option>
                    <option value="emergency">ç·Šæ€¥</option>
                </select>
            </div>
            <div class="form-group">
                <label>é ç®—</label>
                <input type="number" id="editCaseBudget" class="form-control" step="0.01">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button type="submit" class="action-btn save-btn" style="flex: 1;">
                    <i class="fas fa-save"></i> ä¿å­˜
                </button>
                <button type="button" class="action-btn cancel-btn" style="flex: 1;" onclick="closeEditCaseModal()">
                    <i class="fas fa-times"></i> å–æ¶ˆ
                </button>
            </div>
        </form>
    </div>
</div>


    <!-- ç¼–è¾‘FAQæ¨¡æ€æ¡† -->
    <div class="modal" id="editFAQModal">
        <div class="modal-content">
            <h3 id="editFAQModalTitle"><i class="fas fa-question-circle"></i> ç·¨è¼¯FAQ</h3>
            <form id="editFAQForm">
                <input type="hidden" id="editFAQId">
                <div class="form-group">
                    <label>å•é¡Œ</label>
                    <input type="text" id="editFAQQuestion" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>ç­”æ¡ˆ</label>
                    <textarea id="editFAQAnswer" class="form-control" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label>åˆ†é¡</label>
                    <input type="text" id="editFAQCategory" class="form-control">
                </div>
                <div class="form-group">
                    <label>æ’åº</label>
                    <input type="number" id="editFAQOrder" class="form-control" min="0" step="1">
                </div>
                <div class="form-group">
                    <label>ç‹€æ…‹</label>
                    <select id="editFAQStatus" class="form-control" required>
                        <option value="1">å•Ÿç”¨</option>
                        <option value="0">åœç”¨</option>
                    </select>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="action-btn save-btn" style="flex: 1;">
                        <i class="fas fa-save"></i> ä¿å­˜
                    </button>
                    <button type="button" class="action-btn cancel-btn" style="flex: 1;" onclick="closeEditFAQModal()">
                        <i class="fas fa-times"></i> å–æ¶ˆ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- é€šçŸ¥æç¤º -->
    <div id="notification" class="notification" style="display: none;"></div>

    <script>
        // API åŸºç¤ç¶²å€
        const API_BASE_URL = 'http://localhost:3000/api';
        
        // å…¨å±€å˜é‡
        let currentUsers = [];
        let currentCases = [];
        let currentFaqs = [];
        let caseTypes = [];
        
        // åˆ†é¡µç›¸å…³å˜é‡
        let currentUsersPage = 1;
        let currentCasesPage = 1;
        let currentFaqsPage = 1;
        const itemsPerPage = 10;

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”„ åˆå§‹åŒ–å¾Œå°ç®¡ç†ç³»çµ±...');
            loadAdminData();
            loadCaseTypes();
        });

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.display = show ? 'flex' : 'none';
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

       // API è¯·æ±‚å‡½æ•° - æ”¹è¿›ç‰ˆæœ¬
async function apiCall(endpoint, options = {}) {
    try {
        const response = await fetch(`${API_BASE_URL}${endpoint}`, {
            headers: {
                'Content-Type': 'application/json',
                ...options.headers
            },
            ...options
        });
        
        if (!response.ok) {
            // å°è¯•è·å–è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
            let errorMessage = `HTTP error! status: ${response.status}`;
            try {
                const errorData = await response.json();
                errorMessage = errorData.message || errorData.error || errorMessage;
                console.error('APIé”™è¯¯è¯¦æƒ…:', errorData);
            } catch (e) {
                // å¦‚æœæ— æ³•è§£æJSONï¼Œä½¿ç”¨é»˜è®¤é”™è¯¯ä¿¡æ¯
            }
            throw new Error(errorMessage);
        }
        
        return await response.json();
    } catch (error) {
        console.error(`API å‘¼å«å¤±æ•— ${endpoint}:`, error);
        throw error;
    }
}

        // åŠ è½½ç®¡ç†å‘˜æ•°æ®
        async function loadAdminData() {
            try {
                showLoading(true);
                
                // åŠ è½½ç»Ÿè®¡æ•°æ®
                const stats = await apiCall('/admin/stats');
                renderStats(stats);
                
                // åŠ è½½ç”¨æˆ·åˆ—è¡¨
                await loadUsers();
                
                // åŠ è½½æ¡ˆä»¶åˆ—è¡¨
                await loadCases();
                
                // åŠ è½½FAQåˆ—è¡¨
                await loadFaqs();
                
            } catch (error) {
                console.error('è¼‰å…¥ç®¡ç†å“¡è³‡æ–™éŒ¯èª¤:', error);
                showNotification('è¼‰å…¥ç®¡ç†å“¡è³‡æ–™å¤±æ•—: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // æ¸²æŸ“ç»Ÿè®¡æ•°æ®
        function renderStats(stats) {
            document.getElementById('adminStats').innerHTML = `
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <div class="stat-number">${stats.totalUsers}</div>
                    <div>ç¸½ç”¨æˆ¶æ•¸</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-clipboard-list"></i>
                    <div class="stat-number">${stats.totalCases}</div>
                    <div>ç¸½æ¡ˆä»¶æ•¸</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-hourglass-half"></i>
                    <div class="stat-number">${stats.activeCases}</div>
                    <div>é€²è¡Œä¸­æ¡ˆä»¶</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-check-circle"></i>
                    <div class="stat-number">${stats.completedCases}</div>
                    <div>å·²å®Œæˆæ¡ˆä»¶</div>
                </div>
            `;
        }

        // åŠ è½½ç”¨æˆ·åˆ—è¡¨
        async function loadUsers() {
            try {
                currentUsers = await apiCall('/admin/users');
                
                // æ›´æ–°è®¡æ•°
                document.getElementById('usersCount').textContent = `å…± ${currentUsers.length} ä½ç”¨æˆ¶`;
                
                renderUsersTable(currentUsers);
                renderPagination('usersPagination', currentUsers.length, currentUsersPage, 'users');
                
            } catch (error) {
                console.error('è¼‰å…¥ç”¨æˆ¶åˆ—è¡¨éŒ¯èª¤:', error);
                showNotification('è¼‰å…¥ç”¨æˆ¶åˆ—è¡¨å¤±æ•—', 'error');
            }
        }

        // åŠ è½½æ¡ˆä»¶åˆ—è¡¨
        async function loadCases() {
            try {
                currentCases = await apiCall('/admin/cases');
                
                // æ›´æ–°è®¡æ•°
                document.getElementById('casesCount').textContent = `å…± ${currentCases.length} å€‹æ¡ˆä»¶`;
                
                renderCasesTable(currentCases);
                renderPagination('casesPagination', currentCases.length, currentCasesPage, 'cases');
                
            } catch (error) {
                console.error('è¼‰å…¥æ¡ˆä»¶åˆ—è¡¨éŒ¯èª¤:', error);
                showNotification('è¼‰å…¥æ¡ˆä»¶åˆ—è¡¨å¤±æ•—', 'error');
            }
        }

        // åŠ è½½FAQåˆ—è¡¨
        async function loadFaqs() {
            try {
                currentFaqs = await apiCall('/faqs');
                
                renderFaqsTable(currentFaqs);
                renderPagination('faqsPagination', currentFaqs.length, currentFaqsPage, 'faqs');
                
            } catch (error) {
                console.error('è¼‰å…¥FAQåˆ—è¡¨éŒ¯èª¤:', error);
                showNotification('è¼‰å…¥FAQåˆ—è¡¨å¤±æ•—', 'error');
            }
        }

        // åŠ è½½æ¡ˆä»¶ç±»å‹
        async function loadCaseTypes() {
            try {
                caseTypes = await apiCall('/case-types');
                
                // å¡«å……æ¡ˆä»¶ç±»å‹ä¸‹æ‹‰é€‰å•
                const caseTypeSelect = document.getElementById('editCaseType');
                caseTypeSelect.innerHTML = caseTypes.map(type => 
                    `<option value="${type.id}">${type.type_name}</option>`
                ).join('');
            } catch (error) {
                console.error('è¼‰å…¥æ¡ˆä»¶é¡å‹éŒ¯èª¤:', error);
            }
        }

        // æ¸²æŸ“ç”¨æˆ·è¡¨æ ¼
        function renderUsersTable(users) {
            const tbody = document.getElementById('usersTableBody');
            
            // åˆ†é¡µé€»è¾‘
            const startIndex = (currentUsersPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedUsers = users.slice(startIndex, endIndex);
            
            if (paginatedUsers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="empty-state">
                            <i class="fas fa-users"></i>
                            <div>æš«ç„¡ç”¨æˆ¶è³‡æ–™</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = paginatedUsers.map(user => `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td>
                        <span class="user-type-badge user-type-${user.user_type}">
                            ${getUserTypeText(user.user_type)}
                        </span>
                    </td>
                    <td>${user.full_name || '-'}</td>
                    <td>${user.phone || '-'}</td>
                    <td>${user.location || '-'}</td>
                    <td>${new Date(user.created_at).toLocaleDateString()}</td>
                    <td>
                        <button class="action-btn edit-btn tooltip" onclick="editUser(${user.id})">
                            <i class="fas fa-edit"></i> ç·¨è¼¯
                            <span class="tooltip-text">ç·¨è¼¯ç”¨æˆ¶</span>
                        </button>
                        <button class="action-btn delete-btn tooltip" onclick="deleteUser(${user.id})">
                            <i class="fas fa-trash"></i> åˆªé™¤
                            <span class="tooltip-text">åˆªé™¤ç”¨æˆ¶</span>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // æ¸²æŸ“æ¡ˆä»¶è¡¨æ ¼
        function renderCasesTable(cases) {
            const tbody = document.getElementById('casesTableBody');
            
            // åˆ†é¡µé€»è¾‘
            const startIndex = (currentCasesPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedCases = cases.slice(startIndex, endIndex);
            
            if (paginatedCases.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <div>æš«ç„¡æ¡ˆä»¶è³‡æ–™</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = paginatedCases.map(caseItem => `
                <tr>
                    <td>${caseItem.id}</td>
                    <td>${caseItem.title}</td>
                    <td>${caseItem.case_type_name || '-'}</td>
                    <td>
                        <span class="status-badge status-${caseItem.status}">
                            ${getStatusText(caseItem.status)}
                        </span>
                    </td>
                    <td>${caseItem.location}</td>
                    <td>${caseItem.created_by_username || '-'}</td>
                    <td>${new Date(caseItem.created_at).toLocaleDateString()}</td>
                    <td>
                        <button class="action-btn edit-btn tooltip" onclick="editCase(${caseItem.id})">
                            <i class="fas fa-edit"></i> ç·¨è¼¯
                            <span class="tooltip-text">ç·¨è¼¯æ¡ˆä»¶</span>
                        </button>
                        <button class="action-btn delete-btn tooltip" onclick="deleteCase(${caseItem.id})">
                            <i class="fas fa-trash"></i> åˆªé™¤
                            <span class="tooltip-text">åˆªé™¤æ¡ˆä»¶</span>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // æ¸²æŸ“FAQè¡¨æ ¼
        function renderFaqsTable(faqs) {
            const tbody = document.getElementById('faqsTableBody');
            
            // åˆ†é¡µé€»è¾‘
            const startIndex = (currentFaqsPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedFaqs = faqs.slice(startIndex, endIndex);
            
            if (paginatedFaqs.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-question-circle"></i>
                            <div>æš«ç„¡FAQè³‡æ–™</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = paginatedFaqs.map(faq => `
                <tr>
                    <td>${faq.id}</td>
                    <td>${faq.question}</td>
                    <td>${faq.answer.substring(0, 50)}${faq.answer.length > 50 ? '...' : ''}</td>
                    <td>${faq.category || '-'}</td>
                    <td>${faq.display_order}</td>
                    <td>
                        <span class="status-badge ${faq.is_active ? 'status-completed' : 'status-cancelled'}">
                            ${faq.is_active ? 'å•Ÿç”¨' : 'åœç”¨'}
                        </span>
                    </td>
                    <td>
                        <button class="action-btn edit-btn tooltip" onclick="editFaq(${faq.id})">
                            <i class="fas fa-edit"></i> ç·¨è¼¯
                            <span class="tooltip-text">ç·¨è¼¯FAQ</span>
                        </button>
                        <button class="action-btn delete-btn tooltip" onclick="deleteFaq(${faq.id})">
                            <i class="fas fa-trash"></i> åˆªé™¤
                            <span class="tooltip-text">åˆªé™¤FAQ</span>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // æ¸²æŸ“åˆ†é¡µæ§ä»¶
        function renderPagination(containerId, totalItems, currentPage, type) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const container = document.getElementById(containerId);
            
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // ä¸Šä¸€é¡µæŒ‰é’®
            if (currentPage > 1) {
                paginationHTML += `<button class="pagination-btn" onclick="changePage('${type}', ${currentPage - 1})"><i class="fas fa-chevron-left"></i></button>`;
            }
            
            // é¡µç æŒ‰é’®
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    paginationHTML += `<button class="pagination-btn active">${i}</button>`;
                } else {
                    paginationHTML += `<button class="pagination-btn" onclick="changePage('${type}', ${i})">${i}</button>`;
                }
            }
            
            // ä¸‹ä¸€é¡µæŒ‰é’®
            if (currentPage < totalPages) {
                paginationHTML += `<button class="pagination-btn" onclick="changePage('${type}', ${currentPage + 1})"><i class="fas fa-chevron-right"></i></button>`;
            }
            
            container.innerHTML = paginationHTML;
        }

        // åˆ‡æ¢é¡µé¢
        function changePage(type, page) {
            switch (type) {
                case 'users':
                    currentUsersPage = page;
                    renderUsersTable(currentUsers);
                    break;
                case 'cases':
                    currentCasesPage = page;
                    renderCasesTable(currentCases);
                    break;
                case 'faqs':
                    currentFaqsPage = page;
                    renderFaqsTable(currentFaqs);
                    break;
            }
            
            // æ›´æ–°åˆ†é¡µæ§ä»¶
            renderPagination(`${type}Pagination`, 
                type === 'users' ? currentUsers.length : 
                type === 'cases' ? currentCases.length : 
                currentFaqs.length, 
                page, type);
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function showAdminTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.admin-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        // æœç´¢åŠŸèƒ½
        function searchTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const activeTab = document.querySelector('.admin-tab-content.active').id;
            
            if (activeTab === 'usersTab') {
                const filteredUsers = currentUsers.filter(user => 
                    user.username.toLowerCase().includes(searchTerm) ||
                    user.email.toLowerCase().includes(searchTerm) ||
                    (user.full_name && user.full_name.toLowerCase().includes(searchTerm)) ||
                    (user.location && user.location.toLowerCase().includes(searchTerm))
                );
                renderUsersTable(filteredUsers);
            } else if (activeTab === 'casesTab') {
                const filteredCases = currentCases.filter(caseItem =>
                    caseItem.title.toLowerCase().includes(searchTerm) ||
                    caseItem.location.toLowerCase().includes(searchTerm) ||
                    (caseItem.case_type_name && caseItem.case_type_name.toLowerCase().includes(searchTerm))
                );
                renderCasesTable(filteredCases);
            } else if (activeTab === 'faqsTab') {
                const filteredFaqs = currentFaqs.filter(faq =>
                    faq.question.toLowerCase().includes(searchTerm) ||
                    faq.answer.toLowerCase().includes(searchTerm) ||
                    (faq.category && faq.category.toLowerCase().includes(searchTerm))
                );
                renderFaqsTable(filteredFaqs);
            }
        }

        // çŠ¶æ€æ–‡æœ¬è½¬æ¢
        function getStatusText(status) {
            const statusMap = {
                'open': 'é–‹æ”¾',
                'in_progress': 'é€²è¡Œä¸­',
                'completed': 'å·²å®Œæˆ',
                'cancelled': 'å·²å–æ¶ˆ'
            };
            return statusMap[status] || status;
        }

        // ç”¨æˆ·ç±»å‹æ–‡æœ¬è½¬æ¢
        function getUserTypeText(userType) {
            const typeMap = {
                'admin': 'ç®¡ç†å“¡',
                'owner': 'é£¼ä¸»',
                'caretaker': 'ç…§é¡§è€…'
            };
            return typeMap[userType] || userType;
        }

        // ç¼–è¾‘ç”¨æˆ·
        async function editUser(userId) {
            try {
                showLoading(true);
                const user = await apiCall(`/admin/users/${userId}`);
                
                // å¡«å……è¡¨å•
                document.getElementById('editUserId').value = user.id;
                document.getElementById('editUsername').value = user.username;
                document.getElementById('editEmail').value = user.email;
                document.getElementById('editUserType').value = user.user_type;
                document.getElementById('editFullName').value = user.full_name || '';
                document.getElementById('editPhone').value = user.phone || '';
                document.getElementById('editLocation').value = user.location || '';
                
                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                document.getElementById('editUserModal').classList.add('active');
            } catch (error) {
                console.error('ç²å–ç”¨æˆ¶è©³æƒ…éŒ¯èª¤:', error);
                showNotification('ç²å–ç”¨æˆ¶è©³æƒ…å¤±æ•—: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

      // ç¼–è¾‘æ¡ˆä»¶ - ä¿®å¾©ç‰ˆæœ¬ï¼ˆç§»é™¤é›»è©±å­—æ®µï¼‰
async function editCase(caseId) {
    try {
        showLoading(true);
        const caseItem = await apiCall(`/admin/cases/${caseId}`);
        
        console.log('æ¡ˆä»¶è¯¦æƒ…:', caseItem);
        
        // å¡«å……è¡¨å• - ç§»é™¤é›»è©±å­—æ®µ
        document.getElementById('editCaseId').value = caseItem.id;
        document.getElementById('editCaseTitle').value = caseItem.title;
        document.getElementById('editCaseDescription').value = caseItem.description || '';
        document.getElementById('editCaseType').value = caseItem.case_type_id;
        document.getElementById('editCaseLocation').value = caseItem.location;
        // ç§»é™¤é›»è©±å­—æ®µï¼šdocument.getElementById('editCasePhone').value = caseItem.phone || '';
        document.getElementById('editCaseStatus').value = caseItem.status;
        document.getElementById('editCaseUrgency').value = caseItem.urgency_level || 'medium';
        document.getElementById('editCaseBudget').value = caseItem.budget || '';
        
        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        document.getElementById('editCaseModal').classList.add('active');
    } catch (error) {
        console.error('ç²å–æ¡ˆä»¶è©³æƒ…éŒ¯èª¤:', error);
        showNotification('ç²å–æ¡ˆä»¶è©³æƒ…å¤±æ•—: ' + error.message, 'error');
    } finally {
        showLoading(false);
    }
}

        // ç¼–è¾‘FAQ
        async function editFaq(faqId) {
            try {
                showLoading(true);
                const faq = await apiCall(`/admin/faqs/${faqId}`);
                
                // å¡«å……è¡¨å•
                document.getElementById('editFAQModalTitle').innerHTML = '<i class="fas fa-question-circle"></i> ç·¨è¼¯FAQ';
                document.getElementById('editFAQId').value = faq.id;
                document.getElementById('editFAQQuestion').value = faq.question;
                document.getElementById('editFAQAnswer').value = faq.answer;
                document.getElementById('editFAQCategory').value = faq.category || '';
                document.getElementById('editFAQOrder').value = faq.display_order || 0;
                document.getElementById('editFAQStatus').value = faq.is_active ? '1' : '0';
                
                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                document.getElementById('editFAQModal').classList.add('active');
            } catch (error) {
                console.error('ç²å–FAQè©³æƒ…éŒ¯èª¤:', error);
                showNotification('ç²å–FAQè©³æƒ…å¤±æ•—: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // æ˜¾ç¤ºæ–°å¢FAQæ¨¡æ€æ¡†
        function showAddFAQModal() {
            // æ¸…ç©ºè¡¨å•
            document.getElementById('editFAQModalTitle').innerHTML = '<i class="fas fa-plus-circle"></i> æ–°å¢FAQ';
            document.getElementById('editFAQId').value = '';
            document.getElementById('editFAQQuestion').value = '';
            document.getElementById('editFAQAnswer').value = '';
            document.getElementById('editFAQCategory').value = '';
            document.getElementById('editFAQOrder').value = currentFaqs.length > 0 ? 
                Math.max(...currentFaqs.map(f => f.display_order)) + 1 : 1;
            document.getElementById('editFAQStatus').value = '1';
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            document.getElementById('editFAQModal').classList.add('active');
        }

        // åˆ é™¤ç”¨æˆ·
        async function deleteUser(userId) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ç”¨æˆ¶å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) return;
            
            try {
                showLoading(true);
                await apiCall(`/admin/users/${userId}`, { method: 'DELETE' });
                
                // ä»æœ¬åœ°æ•°æ®ä¸­ç§»é™¤
                currentUsers = currentUsers.filter(user => user.id !== userId);
                renderUsersTable(currentUsers);
                showNotification('ç”¨æˆ¶åˆªé™¤æˆåŠŸ', 'success');
                
                // é‡æ–°åŠ è½½ç»Ÿè®¡æ•°æ®
                loadAdminData();
            } catch (error) {
                console.error('åˆªé™¤ç”¨æˆ¶å¤±æ•—:', error);
                showNotification('åˆªé™¤å¤±æ•—: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // åˆ é™¤æ¡ˆä»¶
        async function deleteCase(caseId) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æ¡ˆä»¶å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) return;
            
            try {
                showLoading(true);
                await apiCall(`/admin/cases/${caseId}`, { method: 'DELETE' });
                
                // ä»æœ¬åœ°æ•°æ®ä¸­ç§»é™¤
                currentCases = currentCases.filter(caseItem => caseItem.id !== caseId);
                renderCasesTable(currentCases);
                showNotification('æ¡ˆä»¶åˆªé™¤æˆåŠŸ', 'success');
                
                // é‡æ–°åŠ è½½ç»Ÿè®¡æ•°æ®
                loadAdminData();
            } catch (error) {
                console.error('åˆªé™¤æ¡ˆä»¶å¤±æ•—:', error);
                showNotification('åˆªé™¤å¤±æ•—: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // åˆ é™¤FAQ
        async function deleteFaq(faqId) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤FAQå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) return;
            
            try {
                showLoading(true);
                await apiCall(`/admin/faqs/${faqId}`, { method: 'DELETE' });
                
                // ä»æœ¬åœ°æ•°æ®ä¸­ç§»é™¤
                currentFaqs = currentFaqs.filter(faq => faq.id !== faqId);
                renderFaqsTable(currentFaqs);
                showNotification('FAQåˆªé™¤æˆåŠŸ', 'success');
            } catch (error) {
                console.error('åˆªé™¤FAQå¤±æ•—:', error);
                showNotification('åˆªé™¤å¤±æ•—: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // ä¿å­˜ç”¨æˆ·ç¼–è¾‘
        document.getElementById('editUserForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const userId = document.getElementById('editUserId').value;
            const userData = {
                username: document.getElementById('editUsername').value,
                email: document.getElementById('editEmail').value,
                user_type: document.getElementById('editUserType').value,
                full_name: document.getElementById('editFullName').value,
                phone: document.getElementById('editPhone').value,
                location: document.getElementById('editLocation').value
            };
            
            try {
                showLoading(true);
                await apiCall(`/admin/users/${userId}`, {
                    method: 'PUT',
                    body: JSON.stringify(userData)
                });
                
                showNotification('ç”¨æˆ¶æ›´æ–°æˆåŠŸ', 'success');
                closeEditUserModal();
                
                // é‡æ–°åŠ è½½æ•°æ®
                await loadUsers();
                await loadAdminData();
            } catch (error) {
                console.error('æ›´æ–°ç”¨æˆ¶å¤±æ•—:', error);
                showNotification('æ›´æ–°å¤±æ•—: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        });

     // ä¿å­˜æ¡ˆä»¶ç¼–è¾‘ - ç§»é™¤ç”µè¯éªŒè¯
document.getElementById('editCaseForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const caseId = document.getElementById('editCaseId').value;
    const budgetValue = document.getElementById('editCaseBudget').value;
    
    // ç§»é™¤ç”µè¯å­—æ®µ
    const caseData = {
        title: document.getElementById('editCaseTitle').value,
        description: document.getElementById('editCaseDescription').value,
        case_type_id: parseInt(document.getElementById('editCaseType').value),
        location: document.getElementById('editCaseLocation').value,
        status: document.getElementById('editCaseStatus').value,
        urgency_level: document.getElementById('editCaseUrgency').value,
        budget: budgetValue ? parseFloat(budgetValue) : null
    };
    
    // éªŒè¯å¿…éœ€å­—æ®µ - ç§»é™¤ç”µè¯éªŒè¯
    const requiredFields = ['title', 'description', 'case_type_id', 'location', 'status'];
    const missingFields = requiredFields.filter(field => !caseData[field]);
    
    if (missingFields.length > 0) {
        showNotification(`è«‹å¡«å¯«ä»¥ä¸‹å¿…å¡«æ¬„ä½: ${missingFields.join(', ')}`, 'error');
        return;
    }
    
    // æ¸…ç†æ•°æ®
    Object.keys(caseData).forEach(key => {
        if (caseData[key] === '' || caseData[key] === undefined) {
            caseData[key] = null;
        }
    });
    
    console.log('å‘é€æ¡ˆä»¶æ•°æ®:', caseData);
    
    try {
        showLoading(true);
        const response = await apiCall(`/admin/cases/${caseId}`, {
            method: 'PUT',
            body: JSON.stringify(caseData)
        });
        
        showNotification('æ¡ˆä»¶æ›´æ–°æˆåŠŸ', 'success');
        closeEditCaseModal();
        
        // é‡æ–°åŠ è½½æ•°æ®
        await loadCases();
        await loadAdminData();
    } catch (error) {
        console.error('æ›´æ–°æ¡ˆä»¶å¤±æ•—:', error);
        showNotification('æ›´æ–°å¤±æ•—: ' + error.message, 'error');
    } finally {
        showLoading(false);
    }
});

        // ä¿å­˜FAQç¼–è¾‘
        document.getElementById('editFAQForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const faqId = document.getElementById('editFAQId').value;
            const faqData = {
                question: document.getElementById('editFAQQuestion').value,
                answer: document.getElementById('editFAQAnswer').value,
                category: document.getElementById('editFAQCategory').value,
                display_order: parseInt(document.getElementById('editFAQOrder').value),
                is_active: document.getElementById('editFAQStatus').value === '1'
            };
            
            try {
                showLoading(true);
                
                if (faqId) {
                    // æ›´æ–°ç°æœ‰FAQ
                    await apiCall(`/admin/faqs/${faqId}`, {
                        method: 'PUT',
                        body: JSON.stringify(faqData)
                    });
                } else {
                    // æ–°å¢FAQ
                    await apiCall('/admin/faqs', {
                        method: 'POST',
                        body: JSON.stringify(faqData)
                    });
                }
                
                showNotification((faqId ? 'FAQæ›´æ–°æˆåŠŸ' : 'FAQæ–°å¢æˆåŠŸ'), 'success');
                closeEditFAQModal();
                
                // é‡æ–°åŠ è½½æ•°æ®
                await loadFaqs();
            } catch (error) {
                console.error('ä¿å­˜FAQå¤±æ•—:', error);
                showNotification('æ“ä½œå¤±æ•—: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        });

        // å…³é—­ç”¨æˆ·ç¼–è¾‘æ¨¡æ€æ¡†
        function closeEditUserModal() {
            document.getElementById('editUserModal').classList.remove('active');
        }

        // å…³é—­æ¡ˆä»¶ç¼–è¾‘æ¨¡æ€æ¡†
        function closeEditCaseModal() {
            document.getElementById('editCaseModal').classList.remove('active');
        }

        // å…³é—­FAQç¼–è¾‘æ¨¡æ€æ¡†
        function closeEditFAQModal() {
            document.getElementById('editFAQModal').classList.remove('active');
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });

        // åˆ·æ–°æ•°æ®
        function refreshData() {
            loadAdminData();
            showNotification('è³‡æ–™å·²åˆ·æ–°', 'info');
        }
    </script>
</body>
</html>